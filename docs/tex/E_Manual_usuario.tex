\apendice{Documentación de usuario}

\section{Introducción}

Este manual detalla todos los pasos necesarios para poder instalar en cualquier plataforma la aplicación. Se definirán los requisitos previos que tiene que tener los usuarios así como un manual de uso de la propia página web.

\section{Requisitos de usuarios}

La aplicación utiliza la tecnología de docker para funcionar, con todas sus ventajas y un pequeño inconveniente:

\begin{itemize}
	\item \textbf{Necesitas tener docker instalado en el equipo en el que vayas a desplegar la aplicación.}
\end{itemize}

Los requisitos indispensables para poder utilizar la aplicación son los siguientes:

\begin{enumerate}
	\item Instalar la plataforma de docker \cite{web:dockerDesktop} y docker compose \cite{web:dockercompose}.
	\begin{itemize}
		\item Windows: Docker Desktop.
		\item Linux: Instalar Docker y Docker Compose, ya sea con Docker Desktop o desde el repositorio de la versión de linux correspondiente.
		\item Mac: Docker Desktop.
	\end{itemize}
	\item Disponer de un navegador web.
	\item Disponer de un programa para descomprimir ficheros \textit{.zip} o \textit{.tar.gz}.
\end{enumerate}

\section{Instalación}

\subsection{Descarga del código}

La descarga del código se realiza desde esta página: \url{https://github.com/Daniel-Fernandez-UBU/riskRealUBU/releases}

\imagen{instalacionReleases}{Página de selección de release}

Lo recomendable es siempre utilizar la última versión, ya que tendrá el mayor número de funcionalidades y el menor número de errores.

De la imagen anterior se puede ver que tenemos la posibilidad de descargar tres posibles ficheros:

\begin{itemize}
	\item Source code: Comprimido en dos formatos distintintos: Contiene el código completo del proyecto.
	\item Install.zip: Contiene la carpeta de instalación, la única que vamos a necesitar para poner a funcionar nuestra aplicación.
\end{itemize}

\textit{Nota: Si se ha descargado Source code, tras descomprimirlo y acceder a la carpeta del proyecto, se dispondrá de una carpeta \textit{riskreal}, que es donde está la parte que importa para la instalación de la aplicación.}

\subsection{Contenido de la carpeta install}

La estructura de la carpeta es la siguiente:

\imagen{installTree}{Contenido y estructura de la carpeta riskreal.}

\subsubsection{Fichero docker-compose.yml}

Este es el único fichero realmente necesario, ya que con el simple comando \textbf{docker compose up} en el mismo directorio en el que se encuentra este fichero, se levanta la aplicación.

La explicación del contenido se ha realizado en \ref{subsec:dockerComposeFile}.

\subsection{Instalación de la aplicación}

Desde la línea de comandos, navegamos hasta acceder a la carpeta install y estar al mismo nivel que \textit{docker-compose.yml, dbdata y appFiles}.

\subsubsection{Instalación supervisada}

Escribimos \textbf{docker compose up} y empezamos a ver cómo se lanzan las aplicaciones paso a paso. Si es la primera vez, tiene que hacer una descarga de las imágenes al repositorio de imágenes de Docker, por lo que es normal que lleve algo más de tiempo.
\imagen{dockerComposeUP}{Comando para la instalación.}

En la siguiente imagen se ve el resultado de una ejecución correcta:
\imagen{dockerComposeRunning}{Aplicación funcionando.}

Desde otra consola de símbolo del sistema o desde Docker Desktop, podemos ver nuestros contenedores funcionando:
\imagen{dockerWorking}{Dockers en ejecución.}

Para parar la ejecución y eliminar los contenedores, pulsamos \textit{Ctrl + C} y escribimos \textit{docker compose down} en la venta del símbolo del sistema donde estaban en ejecución.
\imagen{dockerStop}{Parada de los docker lanzados.}

\subsubsection{Instalación desatendida}

El proceso es el mismo que en el paso anterior, con la diferencia de que esta vez no vamos a ver cómo se van lanzando los contenedores, pero con la ventaja de que vamos a poder cerrar la ventana del símbolo del sistema y van a seguir en ejecución.

Escribimos \textbf{docker compose up -d} y comprobamos con \textit{docker ps} cuando se han levantado nuestros dockers:
\imagen{dockerComposeUPD}{Comando para la instalación desatendida.}

Si queremos parar la aplicación podemos lanzar el comando \textit{docker compose down} explicado en la sección anterior, pero tenemos que lanzarlo estando a la altura de nuestro fichero \textit{docker-compose.yml} para que funcione.

\section{Manual del usuario}

Este manual va a servir como guía para poder navegar por la aplicación de forma sencilla.
Nota: \textit{Las imágenes de los cuestionarios que se muestran en este manual son imágenes de prueba que se han precargado en cuestionarios de prueba, aunque siempre aparezca la misma.}

En primer lugar accedemos a la aplicación, actualmente la url por defecto de acceso es \url{localhost:8088}.

\imagen{appInicio}{Pantalla de inicio de la aplicación web.}

En la barra superior hay varias opciones disponibles, la de cambio de idioma:

\imagen{appIdioma}{Selección de idioma de la aplicación web.}

Y la de Inicio de Sesión o Registro:

\imagen{appInvitado}{Opciones de usuario de la aplicación web.}

También se puede realizar el cuestionario disponible para usuarios anónimos, pulsando en el botón que tenemos en el centro de la imagen del cuestionario.

Si se selecciona Registro, saldrá un formulario con diversos campos que se tienen que completar, algunos de ellos solo permiten valores de un listado:

\imagen{appRegistro}{Registro en la aplicación web.}

Una vez registrado, se accede a la página de inicio de sesión para que se introduzcan los datos poder acceder a la aplicación.

Si en la página inicial se hubiese seleccionado iniciar sesión:

\imagen{appInicioSesion}{Pantalla de inicio de sesión de la aplicación web.}

Nos encontraríamos con un formulario para incluir el nombre de usuario (correo electrónico) y la contraseña. 

Tras hacerlo se vuelve a la página inicial, desde la que se podrá iniciar un cuestionario, cambiar el idioma, cerrar sesión o ver el perfil.

Al ser un usuario autenticado, aparecerán las dos últimas opciones que se comentaban al pulsar en el nombre de usuario, en la parte superior derecha de la página:

\imagen{appUserEng}{Pantalla de inicio de la aplicación web en inglés.}

Se ha cambiado el idioma a inglés solo para mostrar la funcionalidad.

Al acceder al perfil, se podrán ver todos los datos incluidos durante el registro. 

Se pueden editar todos los datos excepto el nombre de usuario:

\imagen{appPerfil}{Pantalla de perfíl de usuario.}

Al iniciar uno de los cuestionarios disponibles desde la página de inicio, se obtendrá una pantalla similar a esta:

\imagen{appDesCuestionario}{Pantalla de descripción del cuestionario.}

Donde se verá la imágen principal del cuestionario junto con una descripción del mismo. Finalmente se podrá iniciar el cuestionario.

Los cuestionarios tienen un formato similar al siguiente:

\imagen{appIniCuest}{Pantalla de inicio de la aplicación web.}

Con las opciones a la izquierda, la imagen relacionada con la pregunta a la derecha y debajo 3 botones: Anterior, Siguiente o Enviar resultados.

Los botones, según avances en las preguntas, se irán habilitando, para que se pueda retroceder en cualquier momento, lo único indispensable es que si se quiere cambiar de pregunta, se debe seleccionar alguna respuesta previamente. Lo mismo sucede al enviar resultados, por lo que todas las preguntas deben haber sido seleccionadas.

Al llegar a la última pregunta y pulsar en ``Enviar Resultados'', saldrá una nueva pantalla, con el resultado que has obtenido en el test:

\imagen{appResultado}{Pantalla de resultado del cuestionario.}

Si se quiere hacer el cuestionario siendo un invitado, la única diferencia es que tras pulsar en el cuestionario disponible en la página de inicio, antes del proceso anterior, aparece una pantalla donde se piden algunos datos adicionales:

\imagen{appDataGuest}{Pantalla de datos adicionales para los usuarios anónimos.}

Por último, si se ha iniciado sesión con un usuario administrador, se tendrá acceso a más opciones de las indicadas hasta ahora:

\imagen{appAdmin}{Opciones del usuario administrador.}

A continuación, se van a comentar cada una de ellas.

Al seleccionar en la opción de ``Cargar Cuestionario'' accedemos a la siguiente pantalla, desde la que se puede cargar un nuevo json desde el almacenamiento del equipo:

\imagen{appCargarJSON}{Pantalla de carga de archivos json.}

O generar un cuestionario utilizando un json previamente cargado:

\imagen{appGenerarCuestionario}{Pantalla de generación de cuestionarios.}

La opción de ``Descargar resultados'' la tenemos disponible desde cualquier parte de la web, excepto mientras se está realizando un cuestionario, y tras pulsar en ella, se nos descarga de forma automática un archivo \textit{score.csv} con los datos de todos los cuestionarios que se han realizado.

\imagen{appDescargaResultados}{Pantalla tras pulsar en descargar resultados.}

El usuario administrador, desde la opción de Gestión de Roles, puede modificar los permisos sobre la aplicación de otros usuarios, y convertirlos también en administradores:

\imagen{appRoles}{Pantalla de gestión de roles de la aplicación web.}

El rol del usuario administrador no es modificable en ningún caso.

Si al iniciar sesión la contraseña introducida no es correcta, se mostrará una nueva ventana donde se puede proabr de nuevo o restarurarla:
\imagen{appLoginError}{Pantalla inicio de sesión erróneo.}


Al pulsar en \textit{Recuperar contraseña} se abre una nueva ventana donde se pide el el correo electrónico.
\imagen{appPassRecovery}{Pantalla inicio de recuperación de contraseña.}

Si el correo introducido es correcto y el usuario está registrado en la base de datos de la aplicación, pasados unos segundos le llegará un correo a su buzón y la aplicación devolverá a la página de inicio.

El correo de recuperación que se recibe es similar a este:
\imagen{appEmailReceived}{Correo con la nueva contraseña de un solo uso.}

Tras iniciar sesión con la contraseña que se ha recibido, la aplicación pedirá que se cambie:
\imagen{appCambioPass}{Pantalla cambio de contraseña.}

Después de cambiarla, se volverá a la página de inicio con la sesión iniciada.

\clearpage
Por último, para salir de aplicación, al pulsar en ``Cerrar Sesión'' se pedirá confirmación antes de hacerse efectivo:

\imagen{appCerrarSesion}{Pantalla de cierre de sesión.}





